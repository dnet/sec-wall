{% extends "base/_layout.html" %}

{% hyde
    section_title: Documentation
    has_exercises: "True"
    has_this_page: "True"
%}

{% block section_title %}Configuration file format{% endblock %}

{% block exercises %}
    <li>123</li>
{% endblock %}

{% block this_page %}
  <li><a href="#intro">Introduction</a></li>
  <li><a href="#minimal">A minimal config file</a></li>
  <li><a href="#variables">Variables</a>
    <ol>
        <li><a href="#required">Required variables</a>
            <ol>
                <li><a href="#INSTANCE_SECRET">INSTANCE_SECRET</a></li>
                <li><a href="#INSTANCE_UNIQUE">INSTANCE_UNIQUE</a></li>
                <li><a href="#urls">urls</a></li>
            </ol>
        </li>
        <li><a href="#optional">Optional variables</a>
            <ol>
                <li><a href="#add_default_if_not_found">add_default_if_not_found</a></li>
                <li><a href="#add_invocation_id">add_invocation_id</a></li>
                <li><a href="#ca_certs">ca_certs</a></li>
                <li><a href="#certfile">certfile</a></li>
                <li><a href="#client_cert_401_www_auth">client_cert_401_www_auth</a></li>
                <li><a href="#crypto_dir">crypto_dir</a></li>
                <li><a href="#default_url_config">default_url_config</a></li>
                <li><a href="#forbidden">forbidden</a></li>
                <li><a href="#from_backend_ignore">from_backend_ignore</a></li>
                <li><a href="#host">host</a></li>
                <li><a href="#instance_name">instance_name</a></li>
                <li><a href="#internal_server_error">internal_server_error</a></li>
                <li><a href="#keyfile">keyfile</a></li>
                <li><a href="#log">log</a></li>
                <li><a href="#log_file_config">log_file_config</a></li>
                <li><a href="#log_level">log_level</a></li>
                <li><a href="#no_url_match">no_url_match</a></li>
                <li><a href="#not_authorized">not_authorized</a></li>
                <li><a href="#port">port</a></li>
                <li><a href="#quote_path_info">quote_path_info</a></li>
                <li><a href="#quote_query_string">quote_query_string</a></li>
                <li><a href="#server_tag">server_tag</a></li>
                <li><a href="#server_type">server_type</a></li>
                <li><a href="#sign_invocation_id">sign_invocation_id</a></li>
                <li><a href="#syslog_address">syslog_address</a></li>
                <li><a href="#syslog_facility">syslog_facility</a></li>
                <li><a href="#validation_precedence">validation_precedence</a></li>
            </ol>
        </li>
    </ol>
  </li>
{% endblock %}

{% block content %}

{% markdown %}

<h1>Configuration file format</h1>

<h2 id="intro">Introduction</h2>

Once the sec-wall instance's directory has been
[initialized](/documentation/ref-docs/command-line.html#init), it will
contain a <i>config.py</i> file which is the central place for configuring any settings.
The file is a regular Python source code file which means it must adhere to the
Python's syntax.

As far as sec-wall is concerned, the file should simply contain
at least several variables whose values must be within the expected range and type and it's
absolutely none of sec-wall's business to understand where these values come from -
in other words, the whole configuration may, for instance,  be actually stored in
[LDAP](http://en.wikipedia.org/wiki/LDAP) ![](/media/gfx/external-link.png),
fetched through
[RabbitMQ](http://rabbitmq.org) ![](/media/gfx/external-link.png)
and pumped into said variables using
[Telepathy](http://telepathy.freedesktop.org/wiki/) ![](/media/gfx/external-link.png).
The chapters below all picture it like if the variables were manually set to static strings
but it's worth emphasizing that there's no such a requirement, being written in Python,
the config file may be turned highly dynamic.

<h2 id="minimal">A minimal config file</h2>

Here's how a minimal config file may look like. It isn't particularly stunning and
useful because what it does basically is preventing any client application from
passing through but it serves as an example of what is to be expected from the
configuration format. And please, **do not** use it as-is for creating your
own config file from scratch - that's because the INSTANCE_SECRET variable should
be kept out of sight, it's the value many crypto operations depend on so it should
be treated with the utmost care, the one below has become useless the moment it's been
published online. Instead, you should simply
[initialize](/documentation/ref-docs/command-line.html#init)
sec-wall in an empty directory.

{% syntax python %}
# -*- coding: utf-8 -*-

# Don't share it with anyone.
INSTANCE_SECRET = 'dda695cff20d43f7a8d9218b2006749f'

# May be shared with the outside world.
INSTANCE_UNIQUE = '13ab20244fd04b94af6c55e943faf440'

# ##############################################################################

def default():
    return {
        'ssl': True,
        'ssl-cert': True,
        'ssl-cert-commonName':INSTANCE_SECRET,
        'host': 'http://' + INSTANCE_SECRET
    }

urls = [
    ('/*', default()),
]
{% endsyntax %}

<h2 id="variables">Variables</h2>

Configuration variables can be divided into two groups, several required ones
and the prevailing majority of optional variables whose values will be set
automatically unless overridden in the configuration file.

<h4 id="required">Required variables</h4>

The variables listed below are absolutely necessary for the proper functioning
of a sec-wall's instance and new versions of sec-wall are free to assume they
exist in the config file. They're created during
[the initialization process](/documentation/ref-docs/command-line.html#init)
and you just need to make sure they don't get inadvertently deleted.

<ul>
    <li><a href="#INSTANCE_SECRET">INSTANCE_SECRET</a></li>
    <li><a href="#INSTANCE_UNIQUE">INSTANCE_UNIQUE</a></li>
    <li><a href="#urls">urls</a></li>
</ul>

<h5 id="INSTANCE_SECRET">INSTANCE_SECRET</h5>

A string used as a salt when
<a href="/ZZZ">cryptographically signing the requests</a> and in the
automatically generated default configuration - for denying the access
to all client applications. The default value is a UUID4 which should
be enough for most needs. There's really no reason for changing it but
whatever you set the value to, be sure it's strong enough for your
particular requirements. Do also note that the value should be sufficiently
protected from prying eyes, it should be a secret.

Samples:

{% syntax python %}
INSTANCE_SECRET = '740aa279a1f74cd9903f44317e03ca41'
{% endsyntax %}

{% syntax python %}
INSTANCE_SECRET = ':1@{8Q+W#Ilzk?:C23A{JD23A{UXQK@#:X{Z)A@#ALCSM#)'
{% endsyntax %}

<h5 id="INSTANCE_UNIQUE">INSTANCE_UNIQUE</h5>

An identifier assigned to the instance for the purpose of uniquely identifying the requests
transmitted through the proxy. Contrast with <a href="#instance_name">instance_name</a>
variable below, the conceptual difference between the two being that <i>INSTANCE_UNIQUE</i> is considered
to be more of a technical identifier than a name, which <i>instance_name</i> is.

The combination of <i>instance_name and</i> <i>INSTANCE_UNIQUE</i> should be unique across
all sec-wall instances in your environment as it would otherwise
potentially lead to duplicate message identifiers being written to logs. To ensure it,
the default value of <i>INSTANCE_UNIQUE</i> is a UUID4 identifier.

You probably would like to change the default value to something more meaningful
than the default one but it's not strictly necessary as long, as was said before,
the combination of <i>INSTANCE_UNIQUE</i> and <i>instance_name and</i> stays unique.

Samples:

{% syntax python %}
INSTANCE_UNIQUE = '13ab20244fd04b94af6c55e943faf440'
{% endsyntax %}

{% syntax python %}
INSTANCE_UNIQUE = '13917'
{% endsyntax %}

<h5 id="urls">urls</h5>

A list of 2-element lists or tuples each of which describes the URL pattern to
be secured and the particular security configuration guarding the given URL pattern.
Visit the
[chapter dedicated to configuring security for a particular pattern](/documentation/ref-docs/sec-config.html)
for more details.

Sample:

{% syntax python %}
def default():
    return {
        'ssl': False,
        'custom-http': True,
        'custom-http-X-ABC':'foo',
        'add-auth-info': True,
        'sign-auth-info': True,
        'host': 'http://localhost:17090/'
    }

urls = [
    ('/*', default()),
]
{% endsyntax %}

<h4 id="optional">Optional variables</h4>

The variables documented below are all optional and allow for a detailed customization
of sec-wall instances although sane defaults will be used when they're not set explicitly.
Note that what's listed below are only these options that are specific to a sec-wall
instance as a whole,
[all the choices for configuring security of particular URLs are listed in a separate chapter](/documentation/ref-docs/sec-config.html).

<ul>
    <li><a href="#add_default_if_not_found">add_default_if_not_found</a></li>
    <li><a href="#add_invocation_id">add_invocation_id</a></li>
    <li><a href="#ca_certs">ca_certs</a></li>
    <li><a href="#certfile">certfile</a></li>
    <li><a href="#client_cert_401_www_auth">client_cert_401_www_auth</a></li>
    <li><a href="#crypto_dir">crypto_dir</a></li>
    <li><a href="#default_url_config">default_url_config</a></li>
    <li><a href="#forbidden">forbidden</a></li>
    <li><a href="#from_backend_ignore">from_backend_ignore</a></li>
    <li><a href="#host">host</a></li>
    <li><a href="#instance_name">instance_name</a></li>
    <li><a href="#internal_server_error">internal_server_error</a></li>
    <li><a href="#keyfile">keyfile</a></li>
    <li><a href="#log">log</a></li>
    <li><a href="#log_file_config">log_file_config</a></li>
    <li><a href="#log_level">log_level</a></li>
    <li><a href="#no_url_match">no_url_match</a></li>
    <li><a href="#not_authorized">not_authorized</a></li>
    <li><a href="#port">port</a></li>
    <li><a href="#quote_path_info">quote_path_info</a></li>
    <li><a href="#quote_query_string">quote_query_string</a></li>
    <li><a href="#server_tag">server_tag</a></li>
    <li><a href="#server_type">server_type</a></li>
    <li><a href="#sign_invocation_id">sign_invocation_id</a></li>
    <li><a href="#syslog_address">syslog_address</a></li>
    <li><a href="#syslog_facility">syslog_facility</a></li>
    <li><a href="#validation_precedence">validation_precedence</a></li>
</ul>

<h5 id="add_default_if_not_found">add_default_if_not_found</h5>
<h5 id="add_invocation_id">add_invocation_id</h5>
<h5 id="ca_certs">ca_certs</h5>
<h5 id="certfile">certfile</h5>
<h5 id="client_cert_401_www_auth">client_cert_401_www_auth</h5>
<h5 id="crypto_dir">crypto_dir</h5>
<h5 id="default_url_config">default_url_config</h5>
<h5 id="forbidden">forbidden</h5>
<h5 id="from_backend_ignore">from_backend_ignore</h5>
<h5 id="host">host</h5>
<h5 id="instance_name">instance_name</h5>
<h5 id="internal_server_error">internal_server_error</h5>
<h5 id="keyfile">keyfile</h5>
<h5 id="log">log</h5>
<h5 id="log_file_config">log_file_config</h5>
<h5 id="log_level">log_level</h5>
<h5 id="no_url_match">no_url_match</h5>
<h5 id="not_authorized">not_authorized</h5>
<h5 id="port">port</h5>
<h5 id="quote_path_info">quote_path_info</h5>
<h5 id="quote_query_string">quote_query_string</h5>
<h5 id="server_tag">server_tag</h5>
<h5 id="server_type">server_type</h5>
<h5 id="sign_invocation_id">sign_invocation_id</h5>
<h5 id="syslog_address">syslog_address</h5>
<h5 id="syslog_facility">syslog_facility</h5>
<h5 id="validation_precedence">validation_precedence</h5>


{% endmarkdown %}

{% endblock %}
